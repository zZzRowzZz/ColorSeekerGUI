# Code Rewrite Runner - GUI Version

## Обзор проекта
Автоматизационный desktop-приложение с графическим интерфейсом на Go+Gio. Имеет кнопки START/STOP для управления процессом и лог событий в реальном времени. Предназначен для локального запуска на компьютере пользователя (Windows/Linux/macOS).

## Дата обновления
**Последнее обновление**: 18 ноября 2025  
**Язык**: Go 1.21+  
**Платформа**: Desktop GUI (Windows/Linux/macOS)  
**GUI Framework**: Gio (pure Go)

## Ключевые изменения

### Что изменено в новой версии:
1. **Удалена зависимость от OpenCV** - теперь используется pure Go реализация template matching
2. **Упрощена компиляция** - больше не нужно устанавливать MSYS2, MinGW, pkg-config
3. **Быстрая сборка** - компиляция занимает секунды вместо минут
4. **Нет CGo для OpenCV** - robotgo всё еще использует CGo, но он намного проще устанавливается

## Архитектура

### Структура проекта:
```
code-rewrite-runner/
├── automation/        # Пакет с логикой автоматизации
│   └── worker.go     # Поиск цвета, изображений, клики
├── gui/              # Пакет графического интерфейса
│   └── app.go        # Gio GUI с кнопками и логами
├── main.go           # Точка входа, запуск GUI
├── go.mod            # Зависимости проекта
├── build.bat         # Скрипт компиляции для Windows
├── Good.png          # Шаблон изображения (пользователь заменяет)
└── bad.png           # Шаблон изображения (пользователь заменяет)
```

### Зависимости:
- `gioui.org` - pure Go GUI фреймворк (без CGo)
- `github.com/kbinani/screenshot` - захват скриншотов экрана
- `github.com/go-vgo/robotgo` - управление мышью и кликами
- **Pure Go template matching** - собственная реализация поиска изображений

### Алгоритм работы:
1. Инициализация: проверка наличия файлов Good.png и bad.png
2. Основной цикл (каждую секунду):
   - Захват области экрана (x=11, y=420-440)
   - Поиск цвета 0x77604B с допуском ±10
   - Если цвет найден: поиск и клик по Good.png
   - Если цвет не найден: поиск и клик по bad.png
3. Логирование всех действий в консоль

### Реализация поиска изображений:
Используется **двухфазный алгоритм template matching** (coarse-to-fine):
- **Фаза 1**: Грубое сканирование с шагом searchScale (16 пикселей)
- **Фаза 2**: Точное уточнение в радиусе refineRadius (24 пикселя) вокруг лучшей позиции
- Сравнение RGB значений каждого пикселя
- Вычисление similarity score (normalized SAD)
- Клик по центру найденной области если score >= matchThreshold

**Важно**: Pure Go реализация медленнее OpenCV в 10-100 раз, но проще в установке.

## Важные замечания

### Это НЕ веб-приложение!
Проект создан для **локального запуска** на компьютере пользователя. Он требует:
- Графический интерфейс (GUI)
- Доступ к экрану для создания скриншотов
- Возможность управления мышью

### Replit - только для разработки
В Replit можно:
- Редактировать код
- Читать документацию
- Изучать структуру проекта
- Скачать файлы для локальной компиляции

В Replit НЕЛЬЗЯ:
- Запустить программу (нет GUI)
- Протестировать функциональность
- Использовать автоматизацию

## Инструкции для пользователя

### Компиляция на локальном ПК:

**Требования:**
- Go 1.21 или новее
- Только это! Больше ничего не нужно!

**Компиляция:**
```bash
# Windows - используйте build.bat или:
go build -o CodeRewriteRunner.exe main.go

# Linux/macOS
go build -o CodeRewriteRunner main.go
```

### Запуск:
```bash
# Windows
CodeRewriteRunner.exe

# Linux/macOS
./CodeRewriteRunner
```

### Подготовка изображений:
1. Создайте точные скриншоты элементов интерфейса
2. Сохраните как Good.png и bad.png в папку с программой
3. Запустите программу

## Настройка параметров

Все параметры находятся в константах в начале `main.go`:
- `colorX1, colorY1, colorX2, colorY2` - область поиска цвета
- `targetColor` - искомый цвет (HEX)
- `shadeVariation` - допуск по оттенку
- `goodImagePath, badImagePath` - пути к изображениям
- `matchThreshold` - порог совпадения для поиска изображений (0.80 по умолчанию)
- `searchScale` - шаг сканирования (16 по умолчанию, больше = быстрее)
- `refineRadius` - радиус уточнения (24 по умолчанию)

## История изменений

- **18.11.2025 (GUI версия)**: Добавлен графический интерфейс с кнопками START/STOP
  - Реализован GUI на Gio (pure Go, без CGo кроме robotgo)
  - Разделена архитектура: automation пакет + gui пакет
  - Добавлены кнопки START/STOP для управления
  - Лог событий в реальном времени в окне программы
  - Обновлен build.bat для компиляции GUI приложения
  - Исправлена логика: если цвет НАЙДЕН → Good.png, если НЕ НАЙДЕН → bad.png
  
- **18.11.2025 (Pure Go версия)**: Переписана на Pure Go, удалена зависимость от OpenCV
  - Реализован двухфазный алгоритм template matching (coarse-to-fine)
  - Исправлена критическая ошибка в findColorInArea (boundary check)
  - Оптимизирован поиск изображений с настраиваемыми параметрами
  - Упрощена компиляция (не требует MSYS2, MinGW, OpenCV)
  - Добавлены параметры: matchThreshold (0.80), searchScale (16), refineRadius (24)
  - Честно задокументированы ограничения производительности
  - Обновлена документация с рекомендациями по оптимизации
  - Создан упрощенный build.bat
  - Проект одобрен architect после полного review
  
- **17.11.2025**: Создан проект с OpenCV
  - Реализован весь функционал из AutoHotkey скрипта
  - Добавлены вспомогательные скрипты для Windows
  - Исправлены утечки памяти OpenCV (Mat resources)

## Предпочтения пользователя
- Язык: Русский
- Операционная система: Windows 11
- Задача: Автоматизация кликов на основе анализа экрана
- Требование: Простая компиляция без сложных зависимостей

## Технические детали

### Преимущества Pure Go реализации:
1. **Простота установки**: только Go, никаких внешних библиотек
2. **Быстрая компиляция**: секунды вместо минут
3. **Переносимость**: один исполняемый файл
4. **Кроссплатформенность**: легко компилируется для любой ОС

### Недостатки Pure Go реализации:
1. **Скорость**: немного медленнее чем OpenCV (но достаточно быстро для большинства задач)
2. **Точность**: может быть чуть менее точной в сложных случаях (регулируется через matchThreshold)

### Когда использовать какую версию:
- **Pure Go версия** (эта): для простоты установки и использования
- **OpenCV версия**: для максимальной точности и скорости (если готовы потратить время на установку)
